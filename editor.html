<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Possible Futures Editor</title>
  
  <!-- Cytoscape.js CDN -->
  <script src="https://unpkg.com/cytoscape@3.22.0/dist/cytoscape.min.js"></script>
  
  <!-- Font Awesome CDN -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">
  
  <!-- Inline CSS -->
  <style>
    body {
      margin: 0;
      background-color: #2a2a2a;
      color: #e0e0e0;
      font-family: Arial, sans-serif;
    }
    #main-container {
      position: relative;
      border: 2px solid #3a3a3a;
      padding: 10px;
      height: 100vh;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
    }
    /* Flex container for graph and properties */
    #graph-and-properties {
      display: flex;
      flex: 1;
      overflow: hidden;
    }
    #graph-container {
      flex: 1;
      background-color: #2a2a2a;
    }
    /* Properties Panel */
    #properties-panel {
      width: 300px;
      background-color: rgba(50, 50, 50, 0.9);
      padding: 15px;
      border-left: 2px solid #3a3a3a;
      box-sizing: border-box;
      color: #e0e0e0;
      display: flex;
      flex-direction: column;
    }
    /* Split the properties panel */
    #node-properties, #sequence-interface {
      flex: 1;
      overflow-y: auto;
      margin-bottom: 10px;
    }
    #node-properties {
      border-bottom: 1px solid #3a3a3a;
      padding-bottom: 10px;
    }
    #properties-panel h2 {
      margin-top: 0;
      color: #00ced1;
    }
    #properties-panel label {
      display: block;
      margin-top: 10px;
    }
    #properties-panel input, #properties-panel select, #properties-panel textarea {
      width: 100%;
      padding: 5px;
      background-color: #333;
      border: none;
      color: #e0e0e0;
      margin-top: 5px;
      box-sizing: border-box;
    }
    #properties-panel input:focus, #properties-panel select:focus, #properties-panel textarea:focus {
      outline: none;
      border: 1px solid #00ced1;
    }
    /* Sequence Interface Styles */
    #sequence-interface h2 {
      margin-top: 0;
      color: #00ced1;
    }
    #sequence-interface .graph-selector {
      margin-top: 10px;
      width: 100%;
      padding: 5px;
      background-color: #333;
      border: none;
      color: #e0e0e0;
      box-sizing: border-box;
    }
    #sequence-interface .graph-selector:focus {
      outline: none;
      border: 1px solid #00ced1;
    }
    #sequence-list {
      list-style: none;
      padding: 0;
      margin-top: 10px;
      overflow-y: auto;
      max-height: 150px; /* Adjust as needed */
    }
    #sequence-list li {
      display: flex;
      align-items: center;
      margin-bottom: 5px;
    }
    #sequence-list li .node-name {
      flex: 1;
    }
    #sequence-list li .sequence-btns {
      display: flex;
      align-items: center;
    }
    #sequence-list li .sequence-btns button {
      background-color: transparent;
      border: none;
      color: #e0e0e0;
      cursor: pointer;
      font-size: 16px;
      margin-left: 5px;
    }
    #sequence-list li .sequence-btns button:hover {
      color: #1de9b6;
    }
    /* Remove Add Node Button Below List */
    /* Removed the .add-node-btn styles */
    /* Bottom Bar */
    #bottom-bar {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
    }
    #text-area {
      color: #e0e0e0;
      padding: 10px;
      flex: 1;
    }
    #controls-and-branding {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      padding: 10px;
    }
    #controls {
      display: flex;
      align-items: center;
    }
    .btn {
      background-color: transparent;
      border: none;
      padding: 5px;
      margin: 5px;
      cursor: pointer;
      color: #00ced1;
      font-size: 24px;
    }
    .btn:hover {
      color: #1de9b6;
    }
    #branding {
      font-size: 12px;
      margin-top: 5px;
    }
    #branding a {
      color: #a0a0a0;
      text-decoration: none;
    }
    #branding a:hover {
      color: #e0e0e0;
    }
    /* Legend styles */
    #legend {
      position: absolute;
      top: 10px;
      right: 320px; /* Adjusted to account for properties panel width */
      background-color: rgba(50, 50, 50, 0.9);
      padding: 15px;
      border-radius: 4px;
      color: #e0e0e0;
      font-size: 16px;
    }
    #legend .legend-item {
      cursor: pointer;
      color: #a0a0a0;
      margin-bottom: 5px;
      display: flex;
      align-items: center;
    }
    #legend .legend-item.active {
      color: #e0e0e0;
      font-weight: bold;
    }
    #legend .legend-item input {
      background-color: transparent;
      border: none;
      color: #e0e0e0;
      font-size: 16px;
      flex: 1;
    }
    #legend .legend-item input:focus {
      outline: none;
      border-bottom: 1px solid #00ced1;
    }
    #legend .add-graph-btn {
      margin-top: 10px;
      cursor: pointer;
      color: #00ced1;
      display: flex;
      align-items: center;
    }

  </style>
</head>
<body>

  <div id="main-container">
    <!-- Wrapper div -->
    <div id="graph-and-properties">
      <div id="graph-container"></div>

      <!-- Properties Panel -->
      <div id="properties-panel">
        <!-- Node Properties -->
        <div id="node-properties">
          <h2>Properties</h2>
          <label for="node-label">Label:</label>
          <input type="text" id="node-label" value="Node Label">

          <label for="node-shape">Shape:</label>
          <select id="node-shape">
            <option value="ellipse">Ellipse</option>
            <option value="rectangle">Rectangle</option>
            <option value="roundrectangle">Round Rectangle</option>
            <option value="triangle">Triangle</option>
            <option value="diamond">Diamond</option>
            <option value="pentagon">Pentagon</option>
            <option value="hexagon">Hexagon</option>
            <option value="heptagon">Heptagon</option>
            <option value="octagon">Octagon</option>
            <option value="star">Star</option>
            <option value="vee">Vee</option>
            <option value="rhomboid">Rhomboid</option>
          </select>

          <label for="node-annotation">Annotation:</label>
          <textarea id="node-annotation" rows="4">Node Annotation</textarea>
        </div>

        <!-- Sequencing Interface -->
        <div id="sequence-interface">
          <h2>Sequence</h2>

          <!-- Graph Selector -->
          <select id="graph-selector" class="graph-selector">
            <option value="graph1">Graph 1</option>
            <option value="graph2">Graph 2</option>
            <!-- More graphs can be added dynamically -->
          </select>

          <!-- Sequence List -->
          <ul id="sequence-list">
            <!-- Sequence items will be added here -->
            <li>
              <span class="node-name">Node 1</span>
              <div class="sequence-btns">
                <button class="add-node-after-btn" title="Add Node After">
                  <i class="fas fa-plus-circle"></i>
                </button>
                <button class="remove-node-btn" title="Remove Node">
                  <i class="fas fa-minus-circle"></i>
                </button>
              </div>
            </li>
            <!-- Additional nodes can be added -->
          </ul>
        </div>
      </div>
    </div>

    <!-- Legend -->
    <div id="legend">
      <div class="legend-item active">
        <input type="text" id="graph-title" value="Untitled Graph">
      </div>
      <div class="add-graph-btn">
        <i class="fas fa-plus-circle"></i>&nbsp;Add Graph
      </div>
    </div>

    <div id="bottom-bar">
      <div id="text-area">Node Annotation</div>
      <div id="controls-and-branding">
        <div id="controls">
          <button class="btn" id="add-node-btn" title="Add Node">
            <i class="fas fa-plus"></i>
          </button>
          <button class="btn" id="delete-element-btn" title="Delete Selected">
            <i class="fas fa-trash"></i>
          </button>
          <button class="btn" id="load-btn" title="Load Graph">
            <i class="fas fa-upload"></i>
          </button>
          <button class="btn" id="download-btn" title="Download Graph">
            <i class="fas fa-download"></i>
          </button>
          <button class="btn" id="reset-btn" title="Reset Graph">
            <i class="fas fa-redo"></i>
          </button>
          <!-- Moved Preview Button Here -->
          <button class="btn" id="preview-btn" title="Preview Sequence">
            <i class="fas fa-eye"></i>
          </button>
          <!-- Zoom Controls (if implemented) -->
          <!-- <button class="btn" id="zoom-in-btn" title="Zoom In">
            <i class="fas fa-search-plus"></i>
          </button>
          <button class="btn" id="zoom-out-btn" title="Zoom Out">
            <i class="fas fa-search-minus"></i>
          </button> -->
        </div>
        <div id="branding">
          <a href="https://github.com/yourusername/yourrepo" target="_blank">Possible Futures Editor</a>
        </div>
      </div>
    </div>
  </div>

  <!-- Inline JavaScript -->
  <script>

    // Initialize Cytoscape with a single node
    const cy = cytoscape({
      container: document.getElementById('graph-container'),
      elements: [
        {
          data: { id: 'node1', label: 'Node Label', nodeShape: 'ellipse' },
          position: { x: 100, y: 250 }
        }
      ],
      style: [
        // Node styles
        {
          selector: 'node',
          style: {
            'background-color': '#006064',
            'shape': 'data(nodeShape)',
            'width': 60,
            'height': 60,
            'border-width': 2,
            'border-color': '#004d40',
            'color': '#e0e0e0',
            'font-size': 14,
            'text-valign': 'bottom',
            'text-halign': 'center',
            'text-margin-y': 4,
            'content': 'data(label)'
          }
        },
        // Edge styles
        {
          selector: 'edge',
          style: {
            'width': 3,
            'line-color': '#004d40',
            'target-arrow-color': '#004d40',
            'target-arrow-shape': 'triangle',
            'curve-style': 'bezier',
          }
        },
        // Selected node styling
        {
          selector: 'node:selected',
          style: {
            'background-color': '#00ced1',
            'line-color': '#00ced1',
            'target-arrow-color': '#00ced1',
            'source-arrow-color': '#00ced1'
          }
        }
      ],
      layout: {
        name: 'preset'
      },

      userZoomingEnabled: true,
      userPanningEnabled: true,
      zoomingEnabled: true,
      panningEnabled: true,
      minZoom: 0.1,
      maxZoom: 10,
      wheelSensitivity: 0.2
    });

    // Enable node dragging
    cy.nodes().grabify();

    // Variables to store selected node
    let selectedNode = null;

    // DOM Elements
    const nodeLabelInput = document.getElementById('node-label');
    const nodeShapeSelect = document.getElementById('node-shape');
    const nodeAnnotationInput = document.getElementById('node-annotation');
    const textArea = document.getElementById('text-area');

    // Function to update properties panel with selected node's data
    function updatePropertiesPanel(node) {
      if (node) {
        nodeLabelInput.value = node.data('label') || '';
        nodeShapeSelect.value = node.data('nodeShape') || 'ellipse';
        nodeAnnotationInput.value = node.data('annotation') || '';
        nodeLabelInput.disabled = false;
        nodeShapeSelect.disabled = false;
        nodeAnnotationInput.disabled = false;
        textArea.textContent = node.data('annotation') || '';
      } else {
        nodeLabelInput.value = '';
        nodeShapeSelect.value = 'ellipse';
        nodeAnnotationInput.value = '';
        nodeLabelInput.disabled = true;
        nodeShapeSelect.disabled = true;
        nodeAnnotationInput.disabled = true;
        textArea.textContent = '';
      }
    }

    // Event listener for node selection
    cy.on('select unselect', 'node', function(event) {
      selectedNode = event.target;
      if (selectedNode.length > 0) {
        updatePropertiesPanel(selectedNode);
      } else {
        selectedNode = null;
        updatePropertiesPanel(null);
      }
    });

    // Initial call to set properties panel with the default selected node
    if (cy.$('node:selected').length > 0) {
      selectedNode = cy.$('node:selected')[0];
      updatePropertiesPanel(selectedNode);
    } else {
      updatePropertiesPanel(null);
    }

    // Event listeners for property inputs
    nodeLabelInput.addEventListener('input', function() {
      if (selectedNode) {
        selectedNode.data('label', nodeLabelInput.value);
      }
    });

    nodeShapeSelect.addEventListener('change', function() {
      if (selectedNode) {
        selectedNode.data('nodeShape', nodeShapeSelect.value);
      }
    });

    nodeAnnotationInput.addEventListener('input', function() {
      if (selectedNode) {
        selectedNode.data('annotation', nodeAnnotationInput.value);
        textArea.textContent = nodeAnnotationInput.value;
      }
    });

    // Update the node's label in real-time
    cy.on('data', 'node', function(event) {
      const node = event.target;
      node.style('content', node.data('label'));
    });

    // Set initial zoom and pan
    cy.ready(function() {
      cy.zoom(1);
      cy.pan({ x: 0, y: 0 });
    });
  </script>
</body>
</html>
